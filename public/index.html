<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>ROV · Inventario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{color-scheme:dark light}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      font-size:14px; line-height:1.35;
      margin:0; background:#0b0f14; color:#e6ebf0;
    }
    header{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 16px; background:#111827; border-bottom:1px solid #223
    }
    #header-right{display:flex; gap:10px; align-items:center}
    main{max-width:1100px; margin:0 auto; padding:16px}
    .pill{padding:2px 8px; border:1px solid #334; border-radius:999px; font-size:12px; background:#0f1620}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .muted{opacity:.75}

    .panel{display:none}
    .panel.active{display:block}

    #view-auth form{
      width:360px; max-width:92vw; margin:40px auto; padding:14px;
      background:#0d141d; border:1px solid #223; border-radius:10px
    }
    label{display:block; margin-bottom:8px}
    input,select,button,textarea{
      width:100%; font-size:14px;
      background:#0f1620; color:#e6ebf0;
      border:1px solid #334; border-radius:8px;
      padding:6px 10px; height:36px
    }
    textarea{height:auto; min-height:80px}
    button{cursor:pointer}
    button.small{height:32px; padding:4px 10px}
    button[disabled]{opacity:.55; cursor:not-allowed}

    nav.tabs{display:flex; gap:6px; margin:6px 0 12px}
    nav.tabs button{
      background:#0f1620; border:1px solid #223; border-bottom:none;
      border-radius:8px 8px 0 0; padding:6px 10px; height:34px; font-size:13px
    }
    nav.tabs button.active{background:#151f2c}

    table{width:100%; border-collapse:separate; border-spacing:0 6px}
    th,td{text-align:left; padding:8px 10px; vertical-align:top; font-size:13px}
    tbody tr{background:#0d141d; border:1px solid #223}
    .actions{display:flex; gap:6px; flex-wrap:wrap}
    .tag{display:inline-block; background:#192333; border:1px solid #294; padding:2px 6px; border-radius:6px; font-size:12px; margin-right:6px}

    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:10px 0}
    .toolbar select, .toolbar button{width:auto}

    dialog{
      background:#0d141d; color:#e6ebf0; border:1px solid #334; border-radius:8px;
      padding:14px; width:420px; max-width:92vw
    }
    dialog form > *{margin-bottom:8px}
  </style>
</head>
<body>
<header>
  <div><strong>ROV · Inventario</strong></div>
  <div id="header-right">
    <div id="session-info" class="row muted"></div>
    <button id="btn-logout" class="small" style="display:none">Salir</button>
  </div>
</header>

<main>
  <!-- LOGIN -->
  <section id="view-auth" class="panel active">
    <form id="form-login">
      <label>Email<input type="email" id="email" required></label>
      <label>Contraseña<input type="password" id="password" required></label>
      <button type="submit">Entrar</button>
      <div id="auth-alerts"></div>
    </form>
  </section>

  <!-- APP -->
  <section id="view-app" class="panel">
    <nav class="tabs">
      <button data-tab="equipos" class="active">Equipos</button>
      <button data-tab="componentes">Componentes</button>
    </nav>

    <section id="alerts"></section>

    <!-- Equipos -->
    <section id="panel-equipos" class="panel active">
      <div class="toolbar">
        <button id="eq-crear">➕ Crear equipo</button>
        <button id="eq-refrescar">Refrescar</button>
      </div>
      <table>
        <thead><tr><th>Código</th><th>Rol</th><th>Centro</th><th>Componentes ensamblados</th><th>Acciones</th></tr></thead>
        <tbody id="eq-tbody"></tbody>
      </table>
    </section>

    <!-- Componentes -->
    <section id="panel-componentes" class="panel">
      <div class="toolbar">
        <button id="co-refrescar">Refrescar</button>
      </div>
      <table>
        <thead><tr><th>Serie</th><th>Tipo</th><th>Estado</th><th>Ubicación</th><th>Acciones</th></tr></thead>
        <tbody id="co-tbody"></tbody>
      </table>
    </section>
  </section>
</main>

<!-- MODALES -->
<dialog id="modal-form">
  <form method="dialog" id="modal-form-content"></form>
</dialog>

  <!-- Modal: Reportar falla de componente ensamblado -->
<div id="modalFallaEquipo" class="modal hidden">
  <div class="modal-content">
    <h3>Reportar falla</h3>
    <p class="text-sm" id="fallaEquipoTitulo">Equipo: —</p>

    <label for="fallaEquipoComponente">Componente ensamblado</label>
    <select id="fallaEquipoComponente"></select>

    <label for="fallaEquipoDetalle">Detalle</label>
    <textarea id="fallaEquipoDetalle" rows="4" placeholder="Describe la falla..."></textarea>

    <div class="modal-actions">
      <button id="btnFallaEquipoCancelar" class="btn-secondary">Cancelar</button>
      <button id="btnFallaEquipoEnviar" class="btn-primary">Reportar</button>
    </div>
  </div>
</div>

<style>
  /* estilos mínimos de modal (si ya tienes estilos, omite esto) */
  .modal.hidden{display:none}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;z-index:50}
  .modal-content{background:#111827;color:#e5e7eb;max-width:480px;width:92%;padding:16px;border-radius:12px}
  .modal-content h3{margin-top:0;margin-bottom:8px}
  .modal-content label{display:block;margin-top:12px;margin-bottom:4px;font-size:.9rem;color:#9ca3af}
  .modal-content select,.modal-content textarea{width:100%;background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:8px;padding:8px}
  .modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  .btn-primary{background:#2563eb;border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
  .btn-secondary{background:#374151;border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
</style>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script type="module" src="./env.js"></script>
<script type="module" src="./js/main.js"></script>
</body>
</html>

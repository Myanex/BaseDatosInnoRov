<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>ROV · Inventario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{color-scheme:dark light}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      font-size:14px; line-height:1.35;
      margin:0; background:#0b0f14; color:#e6ebf0;
    }
    header{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 16px; background:#111827; border-bottom:1px solid #223
    }
    #header-right{display:flex; gap:10px; align-items:center}
    main{max-width:1100px; margin:0 auto; padding:16px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .pill{padding:2px 8px; border:1px solid #334; border-radius:999px; font-size:12px; background:#0f1620}
    .muted{opacity:.75}

    /* Panels */
    .panel{display:none}
    .panel.active{display:block}

    /* Auth form compacto */
    #view-auth form{
      width:360px; max-width:92vw; margin:40px auto; padding:14px;
      background:#0d141d; border:1px solid #223; border-radius:10px
    }
    label{display:block; margin-bottom:8px}
    input,select,button,textarea{
      width:100%; font-size:14px;
      background:#0f1620; color:#e6ebf0;
      border:1px solid #334; border-radius:8px;
      padding:6px 10px; height:36px
    }
    textarea{height:auto; min-height:80px}
    button{cursor:pointer}
    button.small{height:32px; padding:4px 10px}
    button[disabled]{opacity:.55; cursor:not-allowed}

    /* Tabs compactas */
    nav.tabs{display:flex; gap:6px; margin:6px 0 12px}
    nav.tabs button{
      background:#0f1620; border:1px solid #223; border-bottom:none;
      border-radius:8px 8px 0 0; padding:6px 10px; height:34px; font-size:13px
    }
    nav.tabs button.active{background:#151f2c}

    /* Tablas compactas */
    table{width:100%; border-collapse:separate; border-spacing:0 6px}
    th,td{text-align:left; padding:8px 10px; vertical-align:top; font-size:13px}
    tbody tr{background:#0d141d; border:1px solid #223}
    .actions{display:flex; gap:6px; flex-wrap:wrap}
    .tag{display:inline-block; background:#192333; border:1px solid #294; padding:2px 6px; border-radius:6px; font-size:12px; margin-right:6px}

    /* Toolbars */
    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:10px 0}
    .toolbar select, .toolbar button{width:auto}

    /* Modales compactos */
    dialog{
      background:#0d141d; color:#e6ebf0; border:1px solid #334; border-radius:8px;
      padding:14px; width:420px; max-width:92vw
    }
    dialog form > *{margin-bottom:8px}
  </style>

  <!-- Config y cliente Supabase (deben existir) -->
  <script src="./env.js"></script>
  <script src="./js/supabaseClient.js"></script>
  <!-- Nuestra página -->
  <script src="./js/equipos.js" defer></script>
  <!-- (Opcional) si ya tienes estos archivos activos, déjalos; si no, omítelos -->
  <script src="./js/auth.js" defer></script>
  <script src="./js/main.js" defer></script>
  <script src="./js/componentes.js" defer></script>
</head>
<body>
<header>
  <div><strong>ROV · Inventario</strong></div>
  <div id="session-badges" class="row muted"></div>
  <div id="header-right">
    <button id="btn-logout" class="small" style="display:none">Salir</button>
  </div>
</header>

<main>
  <!-- LOGIN -->
  <section id="view-auth" class="panel active">
    <form onsubmit="return false">
      <h3>Ingresar</h3>
      <label>Email
        <input id="auth-email" type="email" placeholder="tu@correo.com" />
      </label>
      <label>Contraseña
        <input id="auth-pass" type="password" placeholder="••••••••" />
      </label>
      <div class="row">
        <button id="btn-login">Entrar</button>
        <span id="auth-msg" class="muted"></span>
      </div>
    </form>
  </section>

  <!-- APP -->
  <section id="view-app" class="panel">
    <nav class="tabs">
      <button data-tab="equipos" class="active">Equipos</button>
      <button data-tab="componentes">Componentes</button>
    </nav>

    <section id="alerts"></section>

    <!-- Página: Equipos -->
    <section id="panel-equipos" class="panel active">
      <div class="toolbar">
        <span class="muted">Verás equipos por RLS (centro) o todos si eres super-rol.</span>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:160px">Código</th>
            <th>Descripción</th>
            <th style="width:260px">Componentes (ensamblados)</th>
            <th style="width:200px">Acciones</th>
          </tr>
        </thead>
        <tbody id="tbl-equipos-body"></tbody>
      </table>
      <div id="equipos-info" class="muted" style="margin-top:6px">—</div>
    </section>

    <!-- Página: Componentes (placeholder) -->
    <section id="panel-componentes" class="panel">
      <p class="muted">Usa la pestaña Equipos para “Reportar falla”.</p>
    </section>
  </section>
</main>

<!-- Modal: Reportar falla (dialog) -->
<dialog id="dlg-falla-equipo">
  <form method="dialog">
    <h3 style="margin:0 0 8px">Reportar falla</h3>
    <div id="dlg-falla-equipo-titulo" class="muted" style="margin-bottom:6px">Equipo: —</div>

    <label>Componente ensamblado
      <select id="falla-comp"></select>
    </label>

    <label>Detalle
      <textarea id="falla-det" placeholder="Describe la falla..."></textarea>
    </label>

    <div class="row" style="justify-content:flex-end; margin-top:8px">
      <button id="btn-falla-cancel" class="small" value="cancel">Cancelar</button>
      <button id="btn-falla-send" class="small" value="default">Reportar</button>
    </div>
  </form>
</dialog>

<script>
  // Tabs simples (sin depender de otros scripts)
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('nav.tabs button');
    const pEq  = document.getElementById('panel-equipos');
    const pCo  = document.getElementById('panel-componentes');
    tabs.forEach(btn => btn.addEventListener('click', () => {
      tabs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.getAttribute('data-tab');
      pEq.classList.toggle('active', tab === 'equipos');
      pCo.classList.toggle('active', tab === 'componentes');
    }));
  });
</script>
</body>
</html>

